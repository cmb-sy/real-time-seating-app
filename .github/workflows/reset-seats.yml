name: Reset Seats Scheduler

on:
  schedule:
    # 毎日21時0分に実行（UTC 12:00）
    - cron: "0 10 * * *"
  # 手動実行用のトリガー
  workflow_dispatch:

jobs:
  reset-seats:
    runs-on: ubuntu-latest
    steps:
      - name: Reset seats data
        run: |
          RESPONSE=$(curl -s -X POST ${{ secrets.RESET_API_ENDPOINT }} \
            -H "Content-Type: application/json" \
            -d '{"authorization":"${{ secrets.RESET_API_KEY }}"}')
          echo "API Response: $RESPONSE"

          # レスポンスからステータスを確認
          if echo "$RESPONSE" | grep -q "success\":true"; then
            echo "座席リセットが完了しました"
          else
            echo "座席リセットに失敗しました"
            echo "$RESPONSE"
            exit 1
          fi
